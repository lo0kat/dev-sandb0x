{
    "variables": {
      "proxmox_node": "pve",
      "proxmox_pool": "local",
      "proxmox_storage": "local-lvm",
      "fedora_version": "38",
      "fedora_arch": "x86_64",
      "ssh_username": "core",
      "proxmox_password": "{{env `PROXMOX_PASS`}}",
      "proxmox_host" : "{{env `PROXMOX_HOST`}}"
    },
    "builders": [
      {
        "type": "proxmox-iso",
        "insecure_skip_tls_verify": true,
        "template_name": "coreos-37",
        "template_description": "Core OS 37, generated on {{ isotime \"2023-05-08T15:04:05Z\" }}",
        "proxmox_url": "{{user `proxmox_host`}}",
        "username": "root@pam",
        "password":"{{user `proxmox_password`}}",
        "node": "{{user `proxmox_node`}}",
        "vm_name": "coreos-vm",
        "cores": 2,
        "memory": 2048,
        "disks":[
            {
              "type": "virtio",
              "disk_size": "16G",
              "storage_pool": "local-lvm"
            }
          ],
          "network_adapters":[
              {
              "model": "virtio",
              "bridge": "vmbr0"
            }
          ],
          "additional_iso_files":[
            {
              "cd_files" :["./config/template.ign"],
              "iso_storage_pool" : "local",
              "unmount" : true
            }
          ],
        "iso_download_pve":true,
        "iso_url": "https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/37.20230401.3.0/x86_64/fedora-coreos-37.20230401.3.0-live.x86_64.iso",
        "iso_storage_pool":"local",
        "iso_checksum":"4f6f77d3417c11f659a7570e75cc394539bf5afaeacd443b6c72c8aea430dd9a",
        "ssh_username": "{{user `ssh_username`}}",
        "boot_wait" : "2s",
        "ssh_private_key_file" : "~/.ssh/dev_bastion",
        "ssh_timeout": "20m",
        "http_directory" : "config",
        "cloud_init" : false,
        "qemu_agent" : true,
        "boot_command" : [
          "<spacebar><wait><spacebar><wait><spacebar><wait><spacebar><wait><spacebar><wait>",
          "<tab><wait>",
          "<down><down><end>",
          " ignition.config.url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/installer.ign",
          "<enter>"
        ]
      
      }
    ],
    "provisioners": [
      {
        "type": "shell",
        "inline": [
          "sudo mkdir /tmp/iso",
          "sudo mount /dev/sr1 /tmp/iso -o ro",
          "sudo coreos-installer install /dev/vda --ignition-file /tmp/iso/template.ign",
          "sudo shutdown -h +1"
        ]
      }
    ]
  }
  